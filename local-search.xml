<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>svg 动画</title>
    <link href="/2023/09/10/svg-animate/"/>
    <url>/2023/09/10/svg-animate/</url>
    
    <content type="html"><![CDATA[<h1 id="svg-动画"><a href="#svg-动画" class="headerlink" title="svg 动画"></a>svg 动画</h1><p><a href="https://css-tricks.com/guide-svg-animations-smil/">动画参考资料链接链接</a> <a href="https://css-tricks.com/guide-svg-animations-smil/">https://css-tricks.com/guide-svg-animations-smil/</a></p><h2 id="SVG-dasharray"><a href="#SVG-dasharray" class="headerlink" title="SVG dasharray"></a>SVG dasharray</h2><p>stroke-dasharray 属性可以设置线段绘制时的间隔<br>stroke-dasharray 数值型值 可以配置2个，第二个值缺省</p><ul><li>stroke-dasharray&#x3D;”4” 代表dash 值和offset间距保持一直</li><li>stroke-dasharray&#x3D;”4 5”  dash宽度为4，每一块间距为5</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.1&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">baseProfile</span>=<span class="hljs-string">&quot;full&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 200, L200, 200, L400, 200&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 250, L200, 250, L400, 250&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="stroke-dashoffset"><a href="#stroke-dashoffset" class="headerlink" title="stroke-dashoffset"></a><a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dashoffset">stroke-dashoffset</a></h2><p>stroke-dashoffset 指定了 dash 模式到路径开始的距离</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.1&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">baseProfile</span>=<span class="hljs-string">&quot;full&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 200, L200, 200, L400, 200&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 250, L200, 250, L400, 250&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 250, L200, 250, L400, 250&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-dashoffset</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br>## 结合dasharray 与 stroke-dashoffset 让路径动起来<br>```html<br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.1&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">baseProfile</span>=<span class="hljs-string">&quot;full&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 200, L200, 200, L400, 200&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 250, L200, 250, L400, 250&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0, 250, L200, 250, L400, 250&quot;</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">&quot;green&quot;</span> <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-dashoffset</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">animate</span> <span class="hljs-attr">attributeName</span>=<span class="hljs-string">&quot;stroke-dashoffset&quot;</span> <span class="hljs-attr">from</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;-20&quot;</span> <span class="hljs-attr">dur</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">&quot;freeze&quot;</span> <span class="hljs-attr">repeatCount</span>=<span class="hljs-string">&quot;indefinite&quot;</span> <span class="hljs-attr">easing</span>=<span class="hljs-string">&quot;linear&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">animate</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/svg/svg-1.gif"></p><h2 id="模拟管道水流动动画"><a href="#模拟管道水流动动画" class="headerlink" title="模拟管道水流动动画"></a>模拟管道水流动动画</h2><p>该动画需要通过 SVGGeometryElement的 getTotalLength 获取全部路径，通过动画设置stroke-dashoffset偏移</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   &lt;svg version=&quot;1.1&quot;<br>     baseProfile=&quot;full&quot;<br>     width=&quot;100%&quot; height=&quot;100%&quot;<br>     xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;<br>     &lt;path<br>        ref=&quot;pathEl2&quot;<br>        fill=&quot;none&quot;<br>        :stroke-dasharray=&quot;dashArray&quot;<br>        stroke=&quot;red&quot;<br>        stroke-width=&quot;6&quot;<br>            d=&quot;M 10,30<br>            A 20,20 0,0,1 50,30<br>            A 20,20 0,0,1 90,30<br>            Q 90,60 50,90<br>            Q 10,60 10,30 z&quot; &gt;<br>            &lt;!-- &lt;animate<br>                attributeName=&quot;dash&quot;<br>                values=&quot;0;5;0&quot;<br>                dur=&quot;10s&quot;<br>                repeatCount=&quot;indefinite&quot; /&gt; --&gt;<br>            &lt;/path&gt;<br><br>     &lt;path<br>        ref=&quot;pathEl&quot;<br>        fill=&quot;none&quot;<br>        :stroke-dasharray=&quot;dashArray&quot;<br>        :stroke-dashoffset=&quot;strokeDashoffset&quot;<br>        stroke-width=&quot;6&quot;<br>        stroke=&quot;green&quot;<br>            d=&quot;M 10,30<br>            A 20,20 0,0,1 50,30<br>            A 20,20 0,0,1 90,30<br>            Q 90,60 50,90<br>            Q 10,60 10,30 z&quot; &gt;<br>            &lt;animate<br>                attributeName=&quot;stroke-dashoffset&quot;<br>                from=&quot;275&quot;<br>                to=&quot;0&quot;<br>                dur=&quot;4s&quot;<br>                repeatCount=&quot;indefinite&quot; /&gt;<br>            &lt;/path&gt; <br>&lt;/svg&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; onMounted, ref &#125; from &#x27;vue&#x27;;<br><br>const pathEl = ref&lt;SVGGeometryElement&gt;()<br><br>const dashArray = ref(275)<br>const strokeDashoffset = ref(-275)<br><br>onMounted(() =&gt; &#123;<br>    const totalLength = pathEl.value?.getTotalLength()<br>    console.log(totalLength)<br><br>&#125;)<br><br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br><br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><p>运行效果预览<br><img src="/img/svg/svg-path-wather.gif"></p><p>其他<br>TODO</p>]]></content>
    
    
    
    <tags>
      
      <tag>svg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>inkscape</title>
    <link href="/2023/09/08/inkscape/"/>
    <url>/2023/09/08/inkscape/</url>
    
    <content type="html"><![CDATA[<h1 id="Inkscape-SVG-自由绘图工具"><a href="#Inkscape-SVG-自由绘图工具" class="headerlink" title="Inkscape SVG 自由绘图工具"></a><a href="https://inkscape.org/zh-hans/doc/tutorials/basic/tutorial-basic.html">Inkscape</a> SVG 自由绘图工具</h1><h2 id="设置文档属性"><a href="#设置文档属性" class="headerlink" title="设置文档属性"></a>设置文档属性</h2><p><img src="/img/inkscape/file-property.png"></p><h2 id="单位设置"><a href="#单位设置" class="headerlink" title="单位设置"></a>单位设置</h2><p><img src="/img/inkscape/file-property.png"></p><ol><li>单位按需设置，可选px, mm 等</li><li>画布大小按需设置宽高</li><li>设置尺寸比例，此处会影响导出未svg 时的大小，建议默认设置为1</li></ol><h2 id="xml-快速编辑"><a href="#xml-快速编辑" class="headerlink" title="xml 快速编辑"></a>xml 快速编辑</h2><p><img src="/img/inkscape/xml-editor.png"></p><ul><li>通过右侧配置蓝可以快速获取页面上节点属性信息&amp;&amp; 编辑</li></ul><h2 id="导出文件"><a href="#导出文件" class="headerlink" title="导出文件"></a>导出文件</h2><p><img src="/img/inkscape/file-export.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>svg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>micro-app 搭建记录</title>
    <link href="/2023/09/06/micro-app/"/>
    <url>/2023/09/06/micro-app/</url>
    
    <content type="html"><![CDATA[<h2 id="搭建平台基座"><a href="#搭建平台基座" class="headerlink" title="搭建平台基座"></a>搭建平台基座</h2><p>｜ 基座与平台无关，技术栈 vite + vue3 + element-plus</p><ul><li>通过vite 脚手架搭建项目</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># npm 7+, extra double-dash is needed:</span><br>npm create vite@latest my-vue-app -- --template vue-ts<br><br></code></pre></td></tr></table></figure><ul><li><p>安装 micro-app </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i @micro-zoe/micro-app --save<br></code></pre></td></tr></table></figure></li><li><p>入口文件添加 <strong>micro-app</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"> <span class="hljs-keyword">import</span> microApp <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@micro-zoe/micro-app&#x27;</span>;<br> microApp.<span class="hljs-title function_">start</span>(&#123;<br>    <span class="hljs-attr">destroy</span>: <span class="hljs-literal">true</span><br> &#125;)<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>()<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#root&#x27;</span>)<br><br></code></pre></td></tr></table></figure></li><li><p>安装element-plus<br>| 由于 micro-app 基座应用的样式类无法被隔离，建议修改elment-plus样式类的命名空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i element-plus<br></code></pre></td></tr></table></figure><p>修改 element-plus 命名空间<br>element plus 当前可以全局导入，如果需要按需导入修改命名空间 可参考官网</p></li></ul><p><strong>设置 ElConfigProvider</strong><br>使用 ElConfigProvider 包装您的根组件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- App.vue --&gt;<br>&lt;template&gt;<br>  &lt;el-config-provider namespace=&quot;sk&quot;&gt;<br>    &lt;router-view&gt;&lt;/router-view&gt;<br>  &lt;/el-config-provider&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p><strong>设置 SCSS 和 CSS 变量</strong><br>创建 styles&#x2F;element&#x2F;index.scss：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/element/index.scss</span><br><span class="hljs-comment">// we can add this to custom namespace, default is &#x27;el&#x27;</span><br><span class="hljs-keyword">@forward</span> <span class="hljs-string">&#x27;element-plus/theme-chalk/src/mixins/config.scss&#x27;</span> with (<br>  <span class="hljs-variable">$namespace</span>: <span class="hljs-string">&#x27;sk&#x27;</span><br>);<br><br><span class="hljs-keyword">@use</span> <span class="hljs-string">&quot;element-plus/theme-chalk/src/index.scss&quot;</span> as *;<br><span class="hljs-comment">// ...</span><br><br></code></pre></td></tr></table></figure><p>在 vite.config.ts 中导入 styles&#x2F;element&#x2F;index.scss：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">preprocessorOptions</span>: &#123;<br>      <span class="hljs-attr">scss</span>: &#123;<br>        <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@use &quot;~/styles/element/index.scss&quot; as *;`</span>,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-comment">// ...</span><br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>子应用 vite 挂载</strong></p><ul><li>挂载子应用路由<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>),<br>  <span class="hljs-attr">routes</span>: [<br>    ...,<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/ys-mse:*&#x27;</span>,<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;mse&#x27;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/mse/index.vue&#x27;</span>),<br>    &#125;,<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure></li><li>vite子应用组件挂载<br>子应用micro-app 中需要区分 URL与baseroute 关系具体可<a href="https://zeroing.jd.com/micro-app/docs.html#/zh-cn/route">参考官网</a><ul><li>URL 为获取index.html静态资源的加载路由</li><li>baseroute 为下发子应用的区分路由</li></ul></li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ts">&lt;template&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mse-iframe-container&quot;</span>&gt;</span></span><br><span class="language-xml">  // 加载vite 应用需要关闭沙箱</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">micro-app</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mse&quot;</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;http://localhost:8004&quot;</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;&#123;&#125;&quot;</span> <span class="hljs-attr">baseroute</span>=<span class="hljs-string">&quot;/child/vite-vue&quot;</span> <span class="hljs-attr">inline</span> <span class="hljs-attr">disablesandbox</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">micro-app</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">EventCenterForMicroApp</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@micro-zoe/micro-app&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> config, &#123; getAppUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/micro-app/config.ts&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">// @ts-ignore 因为vite子应用关闭了沙箱，我们需要为子应用mse创建EventCenterForMicroApp对象来实现数据通信</span></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-variable language_">window</span>.<span class="hljs-property">eventCenterForAppNameVite</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventCenterForMicroApp</span>(<span class="hljs-string">&#x27;mse&#x27;</span>)</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-class">.mse-iframe-container</span> &#123;</span></span><br><span class="language-css"><span class="language-xml">  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h1 id="vite-子应用"><a href="#vite-子应用" class="headerlink" title="vite 子应用"></a>vite 子应用</h1><p>  按照正常方式搭建vite 子应用，main.ts &amp;&amp; serve 服务需要改造</p><ul><li>main.ts 入口文件文件<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMicroData</span> () &#123;<br>  <span class="hljs-comment">// eventCenterForAppNameVite 是基座添加到window的数据通信对象</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">eventCenterForAppNameVite</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;====&gt; mse window&#x27;</span>, <span class="hljs-variable language_">window</span>)<br>    <span class="hljs-comment">// 主动获取基座下发的数据</span><br>    <span class="hljs-keyword">const</span> rootData = <span class="hljs-variable language_">window</span>.<span class="hljs-property">eventCenterForAppNameVite</span>.<span class="hljs-title function_">getData</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mse root getData:&#x27;</span>,<span class="hljs-title function_">toRaw</span>(rootData))<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;__MICRO_APP_ENVIRONMENT__ =======&gt; &#x27;</span>,<span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_ENVIRONMENT__</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;__MICRO_APP_BASE_APPLICATION__ =======&gt; &#x27;</span>,<span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_BASE_APPLICATION__</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;__MICRO_APP_PUBLIC_PATH__ =======&gt; &#x27;</span>,<span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_PUBLIC_PATH__</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;__MICRO_APP_BASE_ROUTE__ =======&gt; &#x27;</span>,<span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_BASE_ROUTE__</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;eventCenterForAppNameVite =======&gt; &#x27;</span>,<span class="hljs-variable language_">window</span>.<span class="hljs-property">eventCenterForAppNameVite</span>)<br>  &#125;<br>&#125;<br><br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">use</span>(router);<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br><br><span class="hljs-title function_">handleMicroData</span>()<br><span class="hljs-comment">// 监听卸载操作</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;unmount&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  app.<span class="hljs-title function_">unmount</span>()<br>  <span class="hljs-comment">// 卸载所有数据监听函数</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">eventCenterForAppNameVite</span>?.<span class="hljs-title function_">clearDataListener</span>()<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;微应用机电卸载了&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>vite.config.ts</li><li>server 需要支持 跨域请求</li><li>打包时处理<ul><li>指定域名设置</li><li>通过动态basePath插件 vite-plugin-dynamic-base  类似webpack __webpack_public_path__</li></ul></li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; fileURLToPath, <span class="hljs-variable constant_">URL</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;node:url&#x27;</span><br><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><span class="hljs-keyword">import</span> vueJsx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span><br><span class="hljs-keyword">import</span> &#123; dynamicBase &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-dynamic-base&#x27;</span><br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">base</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span> ? <span class="hljs-string">&quot;__dynamic_base__&quot;</span> : <span class="hljs-string">&quot;/child/vite-vue/&quot;</span>,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-title function_">vue</span>(),<br>    <span class="hljs-title function_">vueJsx</span>(),<br>    <span class="hljs-comment">//打包后 </span><br>    <span class="hljs-title function_">dynamicBase</span>(&#123;<br>      <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;window.__dynamic_base__&#x27;</span>,<br>      <span class="hljs-attr">transformIndexHtml</span>:  <span class="hljs-literal">true</span><br>    &#125;)<br>  ],<br>  <span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8004</span>,<br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;./src&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))<br>    &#125;<br>  &#125;<br>&#125;)<br><br></code></pre></td></tr></table></figure><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><p><a href="https://zeroing.jd.com/micro-app/docs.html#/zh-cn/deploy">参考官网配置</a></p><h1 id="问题-解决方案"><a href="#问题-解决方案" class="headerlink" title="问题&amp;&amp;解决方案"></a>问题&amp;&amp;解决方案</h1><ol><li><p>部署后无法加载vite 子应用，原因可能</p><ul><li>window.__dynamic_base__ 属性未初始化成功</li><li>基座应用加载vite-vue 子应用时使用了预加载模式，</li></ul></li><li><p>父子资源样式相互污染</p><ul><li>如果基座样式库使用 elment-plus 可以通过自定义命名空间规避污染</li><li>开启沙盒模式进行样式隔离</li></ul></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
